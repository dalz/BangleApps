<html>
    <head>
        <link rel="stylesheet" href="../../css/spectre.min.css">
    </head>
    <body>
        <div id="data"></div>
        <button class="btn btn-default" id="btn-save">Save</button>
        <button class="btn btn-default" id="btn-delete">Delete</button>

        <script src="../../core/lib/interface.js"></script>
        <script>
         let data_elem = document.getElementById("data");

         let file = "termux-workout.ex.json";
         let exs_json;

         function get_data() {
             Util.showModal("Loading...");

             data_elem.innerHTML = "";

             Util.readStorageFile(file, data => {
                 Util.hideModal();

                 try {
                     exs_json = JSON.parse(data);
                 } catch (e) {
                     data_elem.innerHTML = `<pre>${e.toString()}</pre>`;
                 }

                 let ex_rows = data.map(ex =>
                     `<tr>
                          <td>${ex.short}</td>
                          <td>${ex.long}</td>
                          <td>${ex.default_reps}</td>
                      </tr>`
                 ).join("\n");

                 data_elem.innerHTML = `
                     <table>
                         <tr>
                             <th>Short name</th>
                             <th>Long name</th>
                             <th>Default reps</th>
                         </tr>
                         ${ex_rows}
                     </table>`;
             });
         }

         document.getElementById("btn-save").addEventListener("click", () => {
             Util.showModal("Saving...");
             Util.writeStorage(file, exs_json.toString(), Util.hideModal);
         });

         document.getElementById("btn-delete").addEventListener("click", () => {
             Util.showModal("Deleting...");
             Util.eraseStorageFile(file,  {
                 Util.hideModal();
                 get_data();
             });
         });

         function onInit() {
             get_data();
         }
        </script>
    </body>
</html>
